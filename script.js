// ---------- data ----------
const archive = [
  {
    col1: "the great white erection",
    col2: "2025",
    col3: "p5.js, ableton, print",
    col4: "web-based, publication",
    col5: "in-progress",
    description: `<p>in october, i started studying the 622-metre hammersmith flyover. the elevated structure carries the a4 road over a busy central junction in the borough of hammersmith. it was built in 1961 by white, male individuals, pushing and pulling equipment in an <a href="https://www.londonsscreenarchives.org.uk/title/19773/" target="_blank" style="color: blue; text-decoration: underline;">erotic dance</a> of construction work. the flyover is composed of a continuous hollow spine beam, 26 feet wide, with arms to support the outer carriageways. a hollow interior runs the whole length of the structure, accommodating surface drainage, electricity supply, and a water main feeding fire hydrants above. its slender and elegant lines, along with its self-regulating functions, make it impossible to regard as passive or unintelligent. instead, it emerges as a dynamic, (female) entity intricately tied to its environment, its identity inscribed by the powerful white men who built it.</p>
                  <p>&nbsp;</p>
                  <p>at night, i hear cars passing over the flyover. i wonder where people are going so late. i ask myself if my interest in <a href="https://www.researchgate.net/publication/227700296_Container_Technologies" target="_blank" style="color: blue; text-decoration: underline;">container technologies</a> is a compensation for my own relative deficiency in the container department. upon waking, i salute the flyover along with the rising sun. It never rests. Its automated systems ensure a 24-hour facilitating environment to meet the demands of our metropolis: escorting <a href="https://frontdeskapparatus.com/wp/wp-content/uploads/2012/10/Building-Dwelling-Thinking.pdf" target="_blank" style="color: blue; text-decoration: underline;">hasty men</a> to and from the other side, each striving to surmount that which is unsound in them. similar to mothers, who nurture and provide for their infants. i can tell the structure is worn down. rust and other imperfections have quietly settled onto its membrane. perhaps, being porous enables intimacy with its surroundings. can its embrace help me better understand my sexuality? more broadly, does perceiving architecture as an extension of our skin challenge views of gender roles? I use binary code (0s and 1s) to probe these questions, expose the downsides of societal binaries, and offer ways to bridge the gaps.</p>      
                  <p>&nbsp;</p>
                  <p>//references</p>
                  <p>london's screen archives, <a href="https://www.londonsscreenarchives.org.uk/title/19773/" target="_blank" style="color: blue; text-decoration: underline;">the hammersmith flyover, hammersmith</a>, 1961</p>
                  <p>do ho suh, <a href="https://www.itsnicethat.com/news/do-ho-suh-bridging-homes-art-260918" target="_blank" style="color: blue; text-decoration: underline;">bridging home</a>, 2018</p>
                  <p>andrea long chu, <a href="https://www.are.na/block/25966066" target="_blank" style="color: blue; text-decoration: underline;">females</a>, 2019</p>
                  <p>zoë soﬁa, <a href="https://www.researchgate.net/publication/227700296_Container_Technologies" target="_blank" style="color: blue; text-decoration: underline;">container technologies</a>, 2000</p>
                  <p>serpentine galleries, <a href="https://open.spotify.com/episode/1C7PSJMVpnrXkKiJ0JwTDb?si=pQewpY9JT6yCapEy2Jsl3A" target="_blank" style="color: blue; text-decoration: underline;">intimacies: surroundings</a>, 2023</p>
                  <p>martin heidegger, <a href="https://frontdeskapparatus.com/wp/wp-content/uploads/2012/10/Building-Dwelling-Thinking.pdf" target="_blank" style="color: blue; text-decoration: underline;">building dwelling thinking</a>, 1954</p>
                  <p>&nbsp;</p>`,
      images: [
        "images/thegreatwhiteerection/thegreatwhiteerection.png",
        "iframe:https://kilianhoppner.github.io/thegreatwhiteerection/",
        "images/thegreatwhiteerection/thegreatwhiteerection04.png",
        "iframe:https://kilianhoppner.github.io/3dspring/",
        "images/thegreatwhiteerection/thegreatwhiteerection02.png",
        "images/thegreatwhiteerection/thegreatwhiteerection03.png"
        
    ]
  },
  {
    col1: "electronic superhighway",
    col2: "2025",
    col3: "p5.js, ableton",
    col4: "web-based",
    col5: "in-progress",
    description: `<p>electronic superhighway is a term coined in 1974 by video art pioneer <a href="https://en.wikipedia.org/wiki/Nam_June_Paik" target="_blank" style="color: blue; text-decoration: underline;">nam june paik</a>. it forecasts technology's ability to disseminate information and form global connections. using this notion as a starting point, i conduct a series of experiments alluding to: algorithms, information extraction, data as material, digital ecosystems as contested marketplaces etc., in an attempt to understand the fabric that holds together our communication networks.</p>
                  <p>&nbsp;</p>
                  <p> [fig.03] visualises the international organisation for migration's (iom) dtm sudan displacement data from 30 september 2025. it depicts the movement of internally displaced persons (idps) between states, showing the origin and destination of populations. keyboard shortcuts: (h)hide map, (l)line, (e)export.</p>
                  <p>&nbsp;</p>
                  <p>[fig.04] and [fig.05] use ml5.js libraries to examine positionality (x, y). where do we situate in space and how to create connections with things? the intervention of technology is inevitable and will increasingly impact the way we engage with the world (or not). keyboard shortcuts: (h)hide lines, (b)black background.</p>
                  <p>&nbsp;</p>
                  <p>//references</p>
                  <p>international organisation for migration (iom), <a href="https://dtm.iom.int/sudan" target="_blank" style="color: blue; text-decoration: underline;">dtm sudan report</a>, 2025</p>
                  <p>ryoji ikeda, <a href="https://www.180studios.com/data-cosm" target="_blank" style="color: blue; text-decoration: underline;">data-cosm [nº1]</a>, 2023</p>
                  <p>ai weiwei, <a href="https://en.wikipedia.org/wiki/Human_Flow" target="_blank" style="color: blue; text-decoration: underline;">human flow</a>, 2017</p>
                  <p>gloria e. anzaldúa, <a href="https://likeawhisper.wordpress.com/wp-content/uploads/2010/03/anzaldua-now-let-us-shift.pdf" target="_blank" style="color: blue; text-decoration: underline;">light in the dark, chapter 6</a>, 2016</p>
                  <p>yoko ono, john lennon, <a href="https://www.londonsscreenarchives.org.uk/title/19773/" target="_blank" style="color: blue; text-decoration: underline;">the war is over!</a>, 1969</p>
                  <p>charlotte lengersdorf, <a href="https://charlottelengersdorf.com/index.html" target="_blank" style="color: blue; text-decoration: underline;">text/dance editor: writing choreography</a>, 2025</p>
                  <p>bruno munari, <a href="http://imagineallthepeople.info/Munari-1966-Design-as-art.pdf" target="_blank" style="color: blue; text-decoration: underline;">design as art</a>, 1966</p>
                  <p>&nbsp;</p>`,
    images: [
      "images/electronicsuperhighway/electronicsuperhighway04.png",
      "images/electronicsuperhighway/electronicsuperhighway02.png",
      "iframe:https://kilianhoppner.github.io/ELECTRONICSUPERHIGHWAY-MAP/",
      "iframe:https://kilianhoppner.github.io/bodyskeleton/",
      "iframe:https://kilianhoppner.github.io/facemesh/",
      "images/electronicsuperhighway/electronicsuperhighway.png"
      
    ]
  },
  {
    col1: "#surveillancecore pt.01",
    col2: "2024",
    col3: "p5.js",
    col4: "interactive installation",
    col5: "completed",
    description: `<p>#surveillancecore pt.01 is an interactive installation made in collaboration with <a href="https://www.linkedin.com/in/hannah-ogawa-9931ab303/" target="_blank" style="color: blue; text-decoration: underline;"><u>hannah ogawa</u></a>. the camera in [fig.01] is coded to track people's faces and detect their emotions. by transforming personal interactions into data, the installation prompts viewers to reflect on surveillance technology and its capability to blur boundaries between connection and control. it invites critical examination of privacy, agency, and the ethics of observation in the digital age. #surveillancecore is a self-led and ongoing research initiative.</p>
                  <p>&nbsp;</p>
                  <p>//references</p>
                  <p>nam june paik, <a href="https://www.artgallery.nsw.gov.au/collection/works/342.2011.a-f/" target="_blank" style="color: blue; text-decoration: underline;">tv buddha</a>, 1976</p>
                  <p>skepta, <a href="https://www.youtube.com/watch?v=rC-J4x-oTto" target="_blank" style="color: blue; text-decoration: underline;">#skeptacore pt.2</a>, 2023</p>
                  <p>ryoji ikeda, <a href="https://www.ryojiikeda.com/project/datamatics/" target="_blank" style="color: blue; text-decoration: underline;">datamatics</a>, 2006</p>
                  <p>miguel chevalier, <a href="https://www.miguel-chevalier.com/work/anthropometry-1989" target="_blank" style="color: blue; text-decoration: underline;">anthropometry</a>, 1989</p>
                  <p>&nbsp;</p>`,
    images: [
      "iframe:https://kilianhoppner.github.io/surveillancecore-pt.1/",
      "images/surveillancecorept.01/surveillancecorept.01.png",
      "images/surveillancecorept.01/surveillancecorept.01_03.png"
    ]
  },
  {
    col1: "the weather room",
    col2: "2024",
    col3: "processing",
    col4: "interactive installation",
    col5: "completed",
    description: `<p>the weather room is an interactive installation created in collaboration with <a href="https://www.isobellemccall.com/" target="_blank" style="color: blue; text-decoration: underline;">isobelle mccall</a> as part of a media art course at the university of melbourne. in the exhibition space, viewers can influence the ambience through their presence. projected light changes colour from dark blue tones to warm orange hues based on how loud it gets in the room. this creates an audio-visual representation of the human experience with the environment, inviting reflection of our relationship with nature.</p>
                  <p>&nbsp;</p>
                  <p>//references</p>
                  <p>olafur eliasson, <a href="https://olafureliasson.net/artwork/the-weather-project-2003/" target="_blank" style="color: blue; text-decoration: underline;">the weather project</a>, 2003</p>
                  <p>james turrell, <a href="https://www.pacegallery.com/exhibitions/james-turrell-elemental/" target="_blank" style="color: blue; text-decoration: underline;">elemental</a>, 2022</p>
                  <p>julinka ebhardt, francesco tacchini, will yates-johnson, <a href="https://vimeo.com/87979136" target="_blank" style="color: blue; text-decoration: underline;">space replay</a>, 2014</p>
                  <p>john warwicker, <a href="https://www.johnwarwicker.com/sony-connected-identity-1/ez6vgi16gtvobpccjsmq013z90rru2" target="_blank" style="color: blue; text-decoration: underline;">sony connected identity</a>, 2001</p>
                  <p>&nbsp;</p>`,
    images: [
    "images/theweatherroom/theweatherroom01.png", 
    "images/theweatherroom/theweatherroom02.png", 
    "images/theweatherroom/theweatherroom03.png"
  ]
  }
];

// ---------- DOM refs & state ----------
const tableBody = document.getElementById('tableBody');
const toggleAllBtn = document.getElementById('toggleAll');
let allExpanded = false;
const expandedStates = Object.fromEntries(archive.map(e => [e.col1, false]));

// ---------- helper: create media element (not cell) ----------
function createMediaElement(mediaValue, idx) {
  const wrapper = document.createElement('div');
  wrapper.className = 'img-container';
  wrapper.style.marginBottom = 'calc(var(--cell-pad-h) * 2)';

  if (!mediaValue) {
    const img = document.createElement('img');
    img.className = 'thumb-img';
    img.alt = `project image ${idx}`;
    img.src = 'images/image.png';
    wrapper.appendChild(img);
    return wrapper;
  }

  if (typeof mediaValue === 'string' && mediaValue.startsWith('iframe:')) {
    const url = mediaValue.slice('iframe:'.length);

    const ar = document.createElement('div');
    ar.style.position = 'relative';
    ar.style.width = '100%';
    ar.style.maxWidth = '800px';
    ar.style.paddingTop = '65.125%';
    ar.style.overflow = 'hidden';

    const iframe = document.createElement('iframe');
    iframe.src = url;
    iframe.title = `embedded-${idx}`;
    iframe.frameBorder = '0';
    iframe.loading = 'lazy';
    iframe.allow = 'camera; microphone; fullscreen; autoplay';
    iframe.allowFullscreen = true;
    iframe.style.position = 'absolute';
    iframe.style.top = '0';
    iframe.style.left = '0';
    iframe.style.width = '100%';
    iframe.style.height = '100%';
    iframe.style.border = '0';

    ar.appendChild(iframe);
    wrapper.appendChild(ar);
    return wrapper;
  }

  if (typeof mediaValue === 'string' && mediaValue.trim().startsWith('<iframe')) {
    wrapper.innerHTML = mediaValue;
    return wrapper;
  }

  const img = document.createElement('img');
  img.className = 'thumb-img';
  img.alt = `project image ${idx}`;
  img.src = mediaValue;
  wrapper.appendChild(img);
  return wrapper;
}

// ---------- create stacked media cell ----------
function createStackedMediaCell(images, startIdx) {
  const td = document.createElement('td');
  td.classList.add("media-cell");
  td.style.verticalAlign = 'top';
  
  const container = document.createElement('div');
  container.style.display = 'flex';
  container.style.flexDirection = 'column';
  container.style.gap = '0';
  
  // Add first image (e.g., image 0 for column 5)
  if (images[startIdx]) {
    container.appendChild(createMediaElement(images[startIdx], startIdx + 1));
  }
  
  // Add second image (e.g., image 3 for column 5)
  if (images[startIdx + 3]) {
    container.appendChild(createMediaElement(images[startIdx + 3], startIdx + 4));
  }
  
  td.appendChild(container);
  return td;
}

// ---------- render table ----------
function renderTable() {
  tableBody.innerHTML = '';

  archive.forEach(entry => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${entry.col1}</td>
      <td>${entry.col2}</td>
      <td>${entry.col3}</td>
      <td>${entry.col4}</td>
      <td>
        ${entry.col5}
        ${entry.col5.toLowerCase() === 'in-progress' ? '<span class="status-dot"></span>' : ''}
      </td>
      <td></td>
      <td></td>
    `;
    row.addEventListener('click', () => {
      expandedStates[entry.col1] = !expandedStates[entry.col1];
      updateRows();
    });
    tableBody.appendChild(row);

    // Description row with stacked images in columns 5, 6, 7
    const descRow = document.createElement('tr');
    descRow.className = 'description-row';
    descRow.id = `desc-${entry.col1}`;

    descRow.appendChild(document.createElement('td'));

    const descTd = document.createElement('td');
    descTd.className = 'desc-cell';
    descTd.colSpan = 3;
    descTd.innerHTML = entry.description || '';
    descRow.appendChild(descTd);

    // Column 5: images 0 and 3 stacked
    descRow.appendChild(createStackedMediaCell(entry.images || [], 0));
    
    // Column 6: images 1 and 4 stacked
    descRow.appendChild(createStackedMediaCell(entry.images || [], 1));
    
    // Column 7: images 2 and 5 stacked
    descRow.appendChild(createStackedMediaCell(entry.images || [], 2));

    tableBody.appendChild(descRow);
  });

  updateRows();
}

// ---------- update rows ----------
function updateRows() {
  archive.forEach(entry => {
    const descRow = document.getElementById(`desc-${entry.col1}`);
    if (descRow) {
      descRow.style.display = expandedStates[entry.col1] ? 'table-row' : 'none';
    }
  });
  allExpanded = archive.every(e => expandedStates[e.col1]);
  toggleAllBtn.classList.toggle('expanded', allExpanded);
}

// ---------- toggle all ----------
toggleAllBtn.addEventListener('click', () => {
  allExpanded = !allExpanded;
  archive.forEach(e => expandedStates[e.col1] = allExpanded);
  updateRows();
});

// initial render
renderTable();




// ---------- IMAGE FULLSCREEN TOGGLE (clone + click-anywhere-to-close) ----------
document.addEventListener("click", function (e) {
  const thumb = e.target.closest("img.thumb-img");
  const existingClone = document.querySelector('.fullscreen-img-clone');

  // If click is on a thumbnail
  if (thumb) {
    // If a clone already exists...
    if (existingClone) {
      // If it's the same original image -> just close it (toggle off)
      if (existingClone.dataset.orig === (thumb.currentSrc || thumb.src)) {
        existingClone.remove();
        return;
      }
      // Otherwise remove existing clone and proceed to open the new one
      existingClone.remove();
    }

    // Create clone, remove the thumb class (so clone clicks are not treated as thumbnail clicks)
    const clone = thumb.cloneNode(true);
    clone.classList.remove('thumb-img');
    clone.classList.add('fullscreen-img', 'fullscreen-img-clone');

    // Mark origin (helps toggling) — use currentSrc when available for responsive srcsets
    clone.dataset.orig = (thumb.currentSrc || thumb.src);

    // Optional: ensure the clone doesn't inherit any inline constraints from the table
    clone.style.maxWidth = clone.style.maxWidth || '';
    clone.style.maxHeight = clone.style.maxHeight || '';

    // Append clone to body so layout doesn't change
    document.body.appendChild(clone);

    // Don't let the click that opened the clone immediately close it:
    // stopPropagation isn't strictly necessary here because we handled logic above,
    // but keep it minimal and allow default behaviour.
    return;
  }

  // Click anywhere else (including the clone) -> close the clone if present
  if (existingClone) {
    existingClone.remove();
  }
});


// ---------- KEYBOARD FULLSCREEN TOGGLE ----------
document.addEventListener('keydown', function (e) {
  if (e.key.toLowerCase() === 'f') {
    try {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen?.().catch(() => {});
      } else {
        document.exitFullscreen?.().catch(() => {});
      }
    } catch (err) {
      // silently ignore errors
    }
  }
});